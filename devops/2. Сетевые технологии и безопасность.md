Отличные дополнения. Эти вопросы часто становятся «проверочными» на позициях уровня Middle/Senior, так как они показывают глубину понимания того, как на самом деле «бегают байтики».

Ниже объединенный справочник: **Теория, Низкоуровневые процессы и Команды**.

---

# Раздел II: Сетевые технологии (Networking)

## 1. Модели OSI и TCP/IP

Модели описывают, как данные упаковываются и передаются.

* **OSI (7 уровней):** Теоретический эталон. Важно знать: L2 (Data Link — MAC-адреса), L3 (Network — IP), L4 (Transport — TCP/UDP), L7 (Application — HTTP/DNS).
* **TCP/IP (4 уровня):** Практическая модель, на которой построен интернет:
1. **Network Access** (L1-L2 OSI).
2. **Internet** (L3 OSI).
3. **Transport** (L4 OSI).
4. **Application** (L5-L7 OSI).



---

## 2. Низкоуровневая передача: TCP, UDP, DHCP

* **TCP Three-way Handshake:** 1. `SYN` (Клиент: "Давай соединимся?")
2. `SYN-ACK` (Сервер: "Давай, я готов")
3. `ACK` (Клиент: "Ок, погнали").
* **UDP:** "Выстрелил и забыл". Без гарантии доставки, без подтверждений. Используется в видеостриминге, играх и DNS.
* **DHCP (DORA процесс):** Как устройство получает IP-адрес автоматически:
1. **D**iscovery (Клиент кричит: "Где тут сервер?")
2. **O**ffer (Сервер: "Возьми вот этот адрес")
3. **R**equest (Клиент: "Беру этот!")
4. **A**cknowledge (Сервер: "Записал, он твой на время аренды").



---

## 3. Дерево и рекурсия DNS

DNS — это иерархическая база данных. Когда ты идешь на `blog.example.com`:

1. **Local Cache / Hosts:** Проверка у себя.
2. **Recursive Resolver:** Твой DNS-провайдер (например, 8.8.8.8) идет опрашивать дерево:
* **. (Root):** Спрашивает, где зона `.com`.
* **.com (TLD):** Спрашивает, где серверы `example.com`.
* **Authoritative Name Server:** Сервер владельца домена отвечает: "IP для `blog` — 1.2.3.4".


3. **Записи:** **A** (IPv4), **AAAA** (IPv6), **CNAME** (псевдоним), **MX** (почта), **TXT** (проверки владения), **NS** (адреса серверов имен).

---

## 4. Глубокий TLS Handshake

Когда мы заходим на HTTPS, происходит магия шифрования:

1. **Client Hello:** Клиент шлет список поддерживаемых шифров.
2. **Server Hello + Certificate:** Сервер выбирает шифр и присылает свой публичный ключ (в сертификате).
3. **Key Exchange:** Клиент проверяет сертификат через цепочку доверия (CA). Затем генерируется **сессионный ключ** (симметричный), который шифруется публичным ключом сервера и отправляется ему.
4. **Finished:** Теперь обе стороны шифруют данные этим общим секретным ключом.

* *Зачем:* Публичные ключи (асимметрия) нужны только для безопасного обмена общим ключом, которым потом быстро шифруется основной трафик (симметрия).

---

## 5. Keep-Alive: L4 vs L7

Концепция "не закрывать соединение сразу", но работает по-разному:

* **L4 (TCP Keep-Alive):** Это "пульс" на уровне ОС. Пустые пакеты, чтобы понять, что сосед не "умер", и чтобы роутеры/файрволы не закрыли соединение по таймауту idle-времени.
* **L7 (HTTP Keep-Alive):** Позволяет передать несколько HTTP-запросов (картинки, стили) внутри одного TCP-соединения. Это экономит время на Handshake.
* **Разница:** L4 проверяет *живость канала*, L7 оптимизирует *загрузку контента*.

---

## 6. Балансировка и Проксирование

* **L4 Load Balancer:** Работает быстро, просто перекидывает пакеты на основе IP и Порта. Не знает, что внутри пакета.
* **L7 Load Balancer:** Видит HTTP-заголовки, URL, Cookies. Может отправить запрос `/api` на один сервер, а `/static` на другой.
* **NAT:** Заменяет частный IP на публичный. Важно в DevOps: внутри Kubernetes (`Service` типа `ClusterIP`) работает через NAT/IPTables.

---

## 7. Команды для диагностики (Networking Toolkit)

| Задача | Команда |
| --- | --- |
| Посмотреть IP и интерфейсы | `ip a` |
| Кто слушает порт 80? | `ss -tulpn | grep :80` |
| Проверить цепочку DNS | `dig +trace google.com` |
| Трассировка с потерями | `mtr 8.8.8.8` |
| Захват трафика | `tcpdump -i any port 443` |
| Проверить TLS-сертификат | `openssl s_client -connect google.com:443` |
| Проверка доступности порта | `nc -zv 1.2.3.4 22` (Netcat) |
| Маршруты (Default gateway) | `ip route` |

---

### Топовые вопросы на интервью по этому блоку:

1. "У меня не открывается сайт, твои действия?" (Проверка по уровням от пинга до сертификата).
2. "В чем разница между 502 Bad Gateway и 504 Gateway Timeout?" (502 — сервер ответил бредом/упал, 504 — сервер не ответил вовремя).
3. "Что такое MTU и почему пакеты могут дропаться при использовании VPN?" (Размер кадра превышает лимит из-за накладных расходов заголовков туннеля).
