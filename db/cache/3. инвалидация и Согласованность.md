# üü° –ë–ª–æ–∫ 3: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å

### 7. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏: TTL vs –Ø–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

* **TTL (Time To Live):**
* *–°—É—Ç—å:* –ú—ã –ø—Ä–æ—Å—Ç–æ –∂–¥–µ–º. –î–∞–Ω–Ω—ã–µ —Å–∞–º–∏ –ø—Ä–æ—Ç—É—Ö–Ω—É—Ç —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.
* *–ì–∞—Ä–∞–Ω—Ç–∏—è:* **Eventual Consistency** (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≤ –∫–æ–Ω–µ—á–Ω–æ–º —Å—á–µ—Ç–µ).
* *–ú–∏–Ω—É—Å:* –í —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É –∏–ª–∏ —Å—Ç–∞—Ä—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏.


* **–Ø–≤–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (Explicit Deletion):**
* *–°—É—Ç—å:* –ü—Ä–∏ –ª—é–±–æ–º `UPDATE` –≤ –±–∞–∑–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å—ã–ª–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É `redis.del(key)`.
* *–ì–∞—Ä–∞–Ω—Ç–∏—è:* –ë–ª–∏–∂–µ –∫ Strong Consistency, –Ω–æ –≤—Å–µ –µ—â–µ –≤–æ–∑–º–æ–∂–Ω—ã "–≥–æ–Ω–∫–∏".
* *–ú–∏–Ω—É—Å:* –ù—É–∂–Ω–æ –Ω–µ –∑–∞–±—ã—Ç—å –≤—Å—Ç–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ —É–¥–∞–ª–µ–Ω–∏—è –≤–æ –≤—Å–µ –º–µ—Å—Ç–∞ –∫–æ–¥–∞, –≥–¥–µ –º–µ–Ω—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ.



---

### 8. Race Condition: –ü–æ—á–µ–º—É `DEL`, –∞ –Ω–µ `SET`?

–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.
–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º —Å–∏—Ç—É–∞—Ü–∏—é: –¥–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä. –û–¥–∏–Ω –º–µ–Ω—è–µ—Ç —Ü–µ–Ω—É –Ω–∞ 100, –¥—Ä—É–≥–æ–π –Ω–∞ 200.

**–°—Ü–µ–Ω–∞—Ä–∏–π —Å `SET` (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞):**

1. –ü–æ—Ç–æ–∫ –ê –ø–∏—à–µ—Ç –≤ –ë–î: **100**.
2. –ü–æ—Ç–æ–∫ –ë –ø–∏—à–µ—Ç –≤ –ë–î: **200**. (–í –±–∞–∑–µ –ø–æ–±–µ–¥–∏–ª–æ 200 ‚Äî —ç—Ç–æ –≤–µ—Ä–Ω–æ).
3. –ü–æ—Ç–æ–∫ –ë (–±—ã—Å—Ç—Ä—ã–π) –ø–∏—à–µ—Ç –≤ –ö—ç—à: `SET price 200`.
4. –ü–æ—Ç–æ–∫ –ê (–º–µ–¥–ª–µ–Ω–Ω—ã–π, —Å–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞) –ø–∏—à–µ—Ç –≤ –ö—ç—à: `SET price 100`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í –±–∞–∑–µ **200**, –≤ –∫—ç—à–µ **100**. –†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω –Ω–∞–≤—Å–µ–≥–¥–∞ (–¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL).

**–°—Ü–µ–Ω–∞—Ä–∏–π —Å `DEL` (–£–¥–∞–ª–µ–Ω–∏–µ):**

1. –ü–æ—Ç–æ–∫ –ë –¥–µ–ª–∞–µ—Ç `DEL price`.
2. –ü–æ—Ç–æ–∫ –ê –¥–µ–ª–∞–µ—Ç `DEL price`.
3. –ö—ç—à –ø—É—Å—Ç.
4. –°–ª–µ–¥—É—é—â–∏–π —á–∏—Ç–∞—Ç–µ–ª—å –ø–æ–π–¥–µ—Ç –≤ –±–∞–∑—É –∏ –≤–æ–∑—å–º–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (**200**).

---

### 9. Soft TTL (Stale-While-Revalidate)

–ò–Ω–æ–≥–¥–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Å–≤–µ–∂–µ—Å—Ç–∏. –ú—ã –Ω–µ —Ö–æ—Ç–∏–º –∑–∞—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î, –¥–∞–∂–µ –µ—Å–ª–∏ –∫—ç—à –ø—Ä–æ—Ç—É—Ö —Å–µ–∫—É–Ω–¥—É –Ω–∞–∑–∞–¥.

**–ü–∞—Ç—Ç–µ—Ä–Ω:**
–•—Ä–∞–Ω–∏–º –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –∏ –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è.
`{ value: "data", expire_at: 12:00, ttl_hard: 13:00 }`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. –ü—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ 12:05.
2. –ú—ã –≤–∏–¥–∏–º, —á—Ç–æ `expire_at` (12:00) –ø—Ä–æ—à–µ–ª, –Ω–æ –∫–ª—é—á –≤ Redis –µ—â–µ –∂–∏–≤ (Hard TTL –¥–æ 13:00).
3. **–ú—ã –æ—Ç–¥–∞–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ä–∞–∑—É** (–±—ã—Å—Ç—Ä–æ!).
4. –í —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –∏–∑ –ë–î.

---

### 10. –¢—ç–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Tag-based Invalidation)

Redis ‚Äî —ç—Ç–æ Key-Value. –¢–∞–º –Ω–µ–ª—å–∑—è —Å–∫–∞–∑–∞—Ç—å `DELETE WHERE author_id = 5`. –ù–æ —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –∫—ç—à –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ç–µ–π –∞–≤—Ç–æ—Ä–∞?

**–†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Set (–ú–Ω–æ–∂–µ—Å—Ç–≤–∞):**
–ü—Ä–∏ –∑–∞–ø–∏—Å–∏ –∫—ç—à–∞ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≤—è–∑–∏.

1. –ü–∏—à–µ–º —Å—Ç–∞—Ç—å—é: `SET article:1 "Text..."`
2. –ü–∏—à–µ–º —Å—Ç–∞—Ç—å—é: `SET article:2 "Text..."`
3. –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç—ç–≥: `SADD tag:author:5 "article:1" "article:2"`

**–ü—Ä–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

1. –ß–∏—Ç–∞–µ–º –≤—Å–µ –∫–ª—é—á–∏ –∏–∑ —Ç—ç–≥–∞: `SMEMBERS tag:author:5` -> `["article:1", "article:2"]`.
2. –£–¥–∞–ª—è–µ–º –∏—Ö: `DEL article:1 article:2`.
3. –£–¥–∞–ª—è–µ–º —Å–∞–º —Ç—ç–≥.

---

### 11. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π (Key Versioning)

–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –±–æ—Ä—å–±—ã —Å –≥–æ–Ω–∫–∞–º–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏.

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã —É–¥–∞–ª—è—Ç—å –∫–ª—é—á `user:1`, –º—ã –º–µ–Ω—è–µ–º –µ–≥–æ –∏–º—è.

* –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: `v1`. –ò—â–µ–º –≤ –∫—ç—à–µ `user:1:v1`.
* –û–±–Ω–æ–≤–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -> –£–≤–µ–ª–∏—á–∏–ª–∏ –≤–µ—Ä—Å–∏—é –≤ –ë–î –¥–æ `v2`.
* –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏—â–µ—Ç `user:1:v2`.
* **–°—Ç–∞—Ä—ã–π –∫–ª—é—á `user:1:v1` –Ω–∏–∫—Ç–æ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç**, –æ–Ω –ø—Ä–æ—Å—Ç–æ —É–º–∏—Ä–∞–µ—Ç —Å–≤–æ–µ–π —Å–º–µ—Ä—Ç—å—é –ø–æ TTL. –ù–∏–∫–∞–∫–∏—Ö Race Conditions –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏.

---

### 12. CDC (Change Data Capture)

–í–æ–ø—Ä–æ—Å —É—Ä–æ–≤–Ω—è Architect.
**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–±—ã–≤–∞—é—Ç –¥–æ–±–∞–≤–ª—è—Ç—å `redis.del()` –≤ –∫–æ–¥ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –±–∞–∑—ã. –ò–ª–∏ –±–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏–π —Å–∫—Ä–∏–ø—Ç/–∞–¥–º–∏–Ω–∫–∞.

**–†–µ—à–µ–Ω–∏–µ:**
–ù–µ —Ç—Ä–æ–≥–∞—Ç—å –∫—ç—à –∏–∑ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —á—Ç–µ–Ω–∏–µ –ª–æ–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (WAL –≤ Postgres, Binlog –≤ MySQL). –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç: **Debezium**.
2. –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –ë–î –ø–æ–ø–∞–¥–∞–µ—Ç –≤ Kafka.
3. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—å—é–º–µ—Ä —á–∏—Ç–∞–µ—Ç Kafka –∏ —É–¥–∞–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –∫–ª—é—á–∏ –≤ Redis.

**–ü–ª—é—Å:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è, –¥–∞–∂–µ –µ—Å–ª–∏ –±–∞–∑—É –ø–æ–ø—Ä–∞–≤–∏–ª–∏ "—Ä—É–∫–∞–º–∏" —á–µ—Ä–µ–∑ SQL-–∫–æ–Ω—Å–æ–ª—å.

---
