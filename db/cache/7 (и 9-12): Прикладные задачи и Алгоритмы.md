# üü† –ë–ª–æ–∫ 7 (–∏ 9-12): –ü—Ä–∏–∫–ª–∞–¥–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ –ê–ª–≥–æ—Ä–∏—Ç–º—ã

### 24 & 34. Distributed Locks (–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏)

**–ó–∞–¥–∞—á–∞:** –£ –Ω–∞—Å 10 –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤. –ù—É–∂–Ω–æ, —á—Ç–æ–±—ã –∑–∞–¥–∞—á—É "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç" –≤—ã–ø–æ–ª–Ω—è–ª —Ç–æ–ª—å–∫–æ **–æ–¥–∏–Ω** –∏–∑ –Ω–∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (Junior/Middle):**
–ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–º–∞–Ω–¥—É: `SET lock:report:1 "my_uuid" NX PX 30000`

* `NX` (Not Exists): –ó–∞–ø–∏—Å–∞—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç.
* `PX 30000`: TTL 30 —Å–µ–∫—É–Ω–¥ (—á—Ç–æ–±—ã –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å —É–ø–∞–¥–µ—Ç, –ª–æ–∫ —Å–∞–º –æ—Å–≤–æ–±–æ–¥–∏–ª—Å—è).

**–ü—Ä–æ–±–ª–µ–º–∞ "Zombie Process" (Senior):**

1. –°–µ—Ä–≤–∏—Å –ê –≤–∑—è–ª –ª–æ–∫ –Ω–∞ 30 —Å–µ–∫.
2. –°–µ—Ä–≤–∏—Å –ê "–∑–∞–≤–∏—Å" (Stop-the-world GC –∏–ª–∏ –¥–æ–ª–≥–∏–π –∑–∞–ø—Ä–æ—Å) –Ω–∞ 40 —Å–µ–∫.
3. –õ–æ–∫ –ø—Ä–æ—Ç—É—Ö –∏ –∏—Å—á–µ–∑.
4. –°–µ—Ä–≤–∏—Å –ë –≤–∑—è–ª –ª–æ–∫.
5. –°–µ—Ä–≤–∏—Å –ê "–æ–∂–∏–ª" –∏... **—É–¥–∞–ª–∏–ª –ª–æ–∫ –°–µ—Ä–≤–∏—Å–∞ –ë**.
6. –°–µ—Ä–≤–∏—Å –í –≤–∑—è–ª –ª–æ–∫.
7. **–ò—Ç–æ–≥:** –ë –∏ –í —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ù–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞.

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (Safe Release):**
–£–¥–∞–ª—è—Ç—å –ª–æ–∫ –º–æ–∂–Ω–æ **—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Lua-—Å–∫—Ä–∏–ø—Ç**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: "–ê —ç—Ç–æ—Ç –ª–æ–∫ –≤—Å—ë –µ—â–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –º–Ω–µ (–º–æ–µ–º—É UUID)?". –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å.

**Fencing Token (–û–≥—Ä–∞–∂–¥–∞—é—â–∏–π —Ç–æ–∫–µ–Ω):**
–î–ª—è –ø–æ–ª–Ω–æ–π –∑–∞—â–∏—Ç—ã (–∫–æ–≥–¥–∞ —Å–µ—Ä–≤–∏—Å –ê "–æ–∂–∏–ª" –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å–∞—Ç—å –≤ –±–∞–∑—É) –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤–µ—Ä—Å–∏—é —Ç–æ–∫–µ–Ω–∞ (–º–æ–Ω–æ—Ç–æ–Ω–Ω–æ –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–µ–µ —á–∏—Å–ª–æ). –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å—Ç–∞—Ä—ã–π ‚Äî –±–∞–∑–∞ –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç –∑–∞–ø–∏—Å—å.

---

### 35. Redlock (–ê–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞)

–ï—Å–ª–∏ —É –Ω–∞—Å –Ω–µ –æ–¥–∏–Ω Redis, –∞ –∫–ª–∞—Å—Ç–µ—Ä, –æ–±—ã—á–Ω—ã–π `SET NX` –Ω–µ–Ω–∞–¥–µ–∂–µ–Ω (–ú–∞—Å—Ç–µ—Ä —É–ø–∞–ª –¥–æ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ -> –ª–æ–∫ –ø–æ—Ç–µ—Ä—è–ª—Å—è).

**–ê–ª–≥–æ—Ä–∏—Ç–º Redlock:**

1. –£ –Ω–∞—Å –µ—Å—Ç—å, —Å–∫–∞–∂–µ–º, 5 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ Redis.
2. –ö–ª–∏–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –≤–∑—è—Ç—å –ª–æ–∫ –Ω–∞ –≤—Å–µ—Ö 5 –ø–æ –æ—á–µ—Ä–µ–¥–∏.
3. –ï—Å–ª–∏ —É–¥–∞–ª–æ—Å—å –≤–∑—è—Ç—å –Ω–∞ **–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ** (3 –∏–∑ 5) –∏ –≤—Ä–µ–º—è –≤–∑—è—Ç–∏—è –º–µ–Ω—å—à–µ TTL ‚Äî —É—Å–ø–µ—Ö.
4. –≠—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞–¥–µ–∂–Ω—ã–º, –Ω–æ –∫—Ä–∏—Ç–∏–∫—É–µ—Ç—Å—è (–ú–∞—Ä—Ç–∏–Ω–æ–º –ö–ª–µ–ø–ø–º–∞–Ω–æ–º) –∑–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —á–∞—Å–æ–≤.

---

### 25 & 37. Rate Limiting (–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤)

**–ó–∞–¥–∞—á–∞:** –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–µ–ª–∞—Ç—å –Ω–µ –±–æ–ª–µ–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É.

**–í–∞—Ä–∏–∞–Ω—Ç 1: Fixed Window (–°—á–µ—Ç—á–∏–∫)**

* `INCR user:1:request_count` + `EXPIRE 60`.
* **–ü—Ä–æ–±–ª–µ–º–∞:** "–í—Å–ø–ª–µ—Å–∫ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ". –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–µ–ª–∞–ª 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ 12:00:59 –∏ –µ—â–µ 100 –≤ 12:01:01. –ó–∞ 2 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–æ—à–ª–æ 200 –∑–∞–ø—Ä–æ—Å–æ–≤. –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç –ª–µ—á—å.

**–í–∞—Ä–∏–∞–Ω—Ç 2: Sliding Window Log (–°–∫–æ–ª—å–∑—è—â–µ–µ –æ–∫–Ω–æ)**

* –ò—Å–ø–æ–ª—å–∑—É–µ–º **Sorted Set (ZSET)**.
* `ZADD user:1:requests <timestamp> <unique_request_id>`
* –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ: `ZREMRANGEBYSCORE user:1:requests -inf <timestamp_minus_60s>`
* –°—á–∏—Ç–∞–µ–º –∫–æ–ª-–≤–æ: `ZCARD user:1:requests`.
* **–ü–ª—é—Å:** –ò–¥–µ–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å.
* **–ú–∏–Ω—É—Å:** –ñ—Ä–µ—Ç –º–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏ (—Ö—Ä–∞–Ω–∏–º –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å).

**–í–∞—Ä–∏–∞–Ω—Ç 3: Token Bucket (–ê–ª–≥–æ—Ä–∏—Ç–º –≤–µ–¥—Ä–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏)**

* –í Redis —Ö—Ä–∞–Ω–∏–º "—Å–∫–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å" –∏ "–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è".
* –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –≤—ã—á–∏—Å–ª—è–µ–º: `–Ω–æ–≤—ã–µ_—Ç–æ–∫–µ–Ω—ã = (now - last_time) * rate`.
* –†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Lua-—Å–∫—Ä–∏–ø—Ç** –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏.

---

### 26. –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

–ö–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã—Ö **—Å–ª–∏—à–∫–æ–º** –º–Ω–æ–≥–æ.

**Bloom Filter (–§–∏–ª—å—Ç—Ä –ë–ª—É–º–∞):**

* **–í–æ–ø—Ä–æ—Å:** "–ë—ã–ª –ª–∏ —ç—Ç–æ—Ç —é–∑–µ—Ä –Ω–∞ —Å–∞–π—Ç–µ?" (–∏–ª–∏ "–ï—Å—Ç—å –ª–∏ —ç—Ç–æ—Ç URL –≤ –±–∞–∑–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫?").
* **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –í–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö ID (–≥–∏–≥–∞–±–∞–π—Ç—ã), —Ö—Ä–∞–Ω–∏–º –±–∏—Ç–æ–≤—ã–π –º–∞—Å—Å–∏–≤.
* **–ì–∞—Ä–∞–Ω—Ç–∏—è:**
* –ï—Å–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç **"–ù–ï–¢"** ‚Äî –∑–Ω–∞—á–∏—Ç, —Ç–æ—á–Ω–æ –Ω–µ—Ç (100%).
* –ï—Å–ª–∏ –≥–æ–≤–æ—Ä–∏—Ç **"–î–ê"** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –¥–∞, –∞ –≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ (False Positive).


* **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –û—Ç—Å–µ–∫–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –ø–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–ª—é—á–∞–º (–∑–∞—â–∏—Ç–∞ –æ—Ç Cache Penetration).

**HyperLogLog:**

* **–í–æ–ø—Ä–æ—Å:** "–°–∫–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (DAU) –∑–∞—à–ª–æ —Å–µ–≥–æ–¥–Ω—è?"
* **–•—Ä–∞–Ω–µ–Ω–∏–µ:** –û–±—ã—á–Ω—ã–π `Set` –Ω–∞ 1 –º–∏–ª–ª–∏–æ–Ω ID –∑–∞–π–º–µ—Ç ~50 –ú–±. `HyperLogLog` –∑–∞–π–º–µ—Ç **12 –ö–±–∞–π—Ç** (!) –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —á–∏—Å–ª–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
* **–¢–æ—á–Ω–æ—Å—Ç—å:** –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ 0.81%. –î–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —ç—Ç–æ –æ—Ç–ª–∏—á–Ω–æ.

---

### 27. Pub/Sub (–ò–∑–¥–∞—Ç–µ–ª—å/–ü–æ–¥–ø–∏—Å—á–∏–∫)

Redis —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞–∫ —à–∏–Ω—É —Å–æ–æ–±—â–µ–Ω–∏–π.

* **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** `PUBLISH channel "hello"`, `SUBSCRIBE channel`.
* **–û—Ç–ª–∏—á–∏–µ –æ—Ç Kafka/RabbitMQ:**
* **Fire and Forget:** –í Redis –Ω–µ—Ç –ø–∞–º—è—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫ –æ—Ç–≤–∞–ª–∏–ª—Å—è –Ω–∞ —Å–µ–∫—É–Ω–¥—É ‚Äî –æ–Ω **–ø–æ—Ç–µ—Ä—è–ª** –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç.
* **At most once:** –î–æ—Å—Ç–∞–≤–∫–∞ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è.


* **Use Case:** –ß–∞—Ç—ã –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç...", –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ –Ω–∞ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

---