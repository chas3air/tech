# üü† –ë–ª–æ–∫ 6: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¢–æ–ø–æ–ª–æ–≥–∏—è

### 21. Redis Sentinel vs Redis Cluster

–ù–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏ –≤–∞–∂–Ω–æ —á–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å **High Availability (–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å)** –∏ **Sharding (–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏/–æ–±—ä–µ–º–∞)**.

1. **Redis Sentinel (–ß–∞—Å–æ–≤–æ–π):**
* **–¶–µ–ª—å:** High Availability (HA). –ß—Ç–æ–±—ã —Å–∞–π—Ç –Ω–µ –ª–µ–≥, –µ—Å–ª–∏ —É–ø–∞–¥–µ—Ç –ú–∞—Å—Ç–µ—Ä.
* **–¢–æ–ø–æ–ª–æ–≥–∏—è:** 1 Master + N Slaves. –î–∞–Ω–Ω—ã–µ –Ω–∞ –≤—Å–µ—Ö –Ω–æ–¥–∞—Ö **–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ**.
* **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** Sentinel ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. –û–Ω —Å–ª–µ–¥–∏—Ç –∑–∞ –ú–∞—Å—Ç–µ—Ä–æ–º. –ï—Å–ª–∏ –ú–∞—Å—Ç–µ—Ä –∏—Å—á–µ–∑, Sentinel –≥–æ–ª–æ—Å—É–µ—Ç –∏ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –æ–¥–Ω–æ–≥–æ –∏–∑ –°–ª–µ–π–≤–æ–≤ –Ω–æ–≤—ã–º –ú–∞—Å—Ç–µ—Ä–æ–º.
* **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –í—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ø–∞–º—è—Ç—å—é **–æ–¥–Ω–æ–≥–æ** —Å–µ—Ä–≤–µ—Ä–∞ (Scale Up). –ï—Å–ª–∏ —É –≤–∞—Å 64 –ì–± RAM, –≤—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ —Ö—Ä–∞–Ω–∏—Ç—å 100 –ì–± –¥–∞–Ω–Ω—ã—Ö.


2. **Redis Cluster:**
* **–¶–µ–ª—å:** Sharding (–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ). –ß—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Ä–∞–±–∞–π—Ç—ã –¥–∞–Ω–Ω—ã—Ö.
* **–¢–æ–ø–æ–ª–æ–≥–∏—è:** –ú–Ω–æ–≥–æ –ú–∞—Å—Ç–µ—Ä–æ–≤ (M1, M2, M3), —É –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–∏ –°–ª–µ–π–≤—ã. –î–∞–Ω–Ω—ã–µ **—Ä–∞–∑–±–∏—Ç—ã** –Ω–∞ —á–∞—Å—Ç–∏.
* **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –î–∞–Ω–Ω—ã–µ (–∫–ª—é—á–∏) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–º–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ —Ä–∞–∑–Ω—ã–º –Ω–æ–¥–∞–º. –ö–ª–∞—Å—Ç–µ—Ä —Å–∞–º —É–º–µ–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ –Ω—É–∂–Ω—É—é –Ω–æ–¥—É.
* **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (`MULTI/EXEC`) –º–µ–∂–¥—É –∫–ª—é—á–∞–º–∏, –ª–µ–∂–∞—â–∏–º–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–æ–¥–∞—Ö.



---

### 22. –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Consistent Hashing

–ï—Å–ª–∏ —É –Ω–∞—Å 10 —Å–µ—Ä–≤–µ—Ä–æ–≤, –∫–∞–∫ –ø–æ–Ω—è—Ç—å, –Ω–∞ –∫–∞–∫–æ–º –ª–µ–∂–∏—Ç –∫–ª—é—á `user:123`?

**–ü–æ–¥—Ö–æ–¥ 1: Modulo (–û—Å—Ç–∞—Ç–æ–∫ –æ—Ç –¥–µ–ª–µ–Ω–∏—è)**

* `Server_ID = hash(key) % 10`.
* **–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä —Å–≥–æ—Ä–µ–ª (–∏–ª–∏ –¥–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π, —Å—Ç–∞–ª–æ 11), —Ñ–æ—Ä–º—É–ª–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `% 11`.
* **–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞:** –ü–æ—á—Ç–∏ –≤—Å–µ –∫–ª—é—á–∏ –º–µ–Ω—è—é—Ç —Å–≤–æ–∏ –º–µ—Å—Ç–∞. –í–µ—Å—å –∫—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–º–∏—Ä–∞–µ—Ç –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π.

**–ü–æ–¥—Ö–æ–¥ 2: Consistent Hashing (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)**

* **–ò–¥–µ—è:** –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –∫—Ä—É–≥ (–∫–æ–ª—å—Ü–æ), –≥–¥–µ —Ä–∞—Å—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä–∞.
* **–ê–ª–≥–æ—Ä–∏—Ç–º:** –•–µ—à–∏—Ä—É–µ–º –∫–ª—é—á –∏ –ø–æ–º–µ—â–∞–µ–º –µ–≥–æ –Ω–∞ –∫—Ä—É–≥. –ò–¥–µ–º –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –≤—Å—Ç—Ä–µ—á–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.
* **–ü–ª—é—Å:** –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–∞ –∫—Ä—É–≥, –æ–Ω –∑–∞–±–µ—Ä–µ—Ç —á–∞—Å—Ç—å –∫–ª—é—á–µ–π —Ç–æ–ª—å–∫–æ —É —Å–≤–æ–µ–≥–æ "—Å–æ—Å–µ–¥–∞". **90% –∫–ª—é—á–µ–π –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –º–µ—Å—Ç–∞—Ö.**
* *–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:* –í —Å–∞–º–æ–º Redis Cluster –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Ö–æ–∂–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è ‚Äî **Hash Slots** (16384 —Å–ª–æ—Ç–∞), –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É –Ω–æ–¥–∞–º–∏.

---

### 23. Split Brain (–†–∞—Å—â–µ–ø–ª–µ–Ω–Ω—ã–π –º–æ–∑–≥)

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

**–°—Ü–µ–Ω–∞—Ä–∏–π:**

1. –ï—Å—Ç—å –ú–∞—Å—Ç–µ—Ä (–ê) –∏ –°–ª–µ–π–≤ (–ë).
2. –°–ª—É—á–∞–µ—Ç—Å—è —Ä–∞–∑—Ä—ã–≤ —Å–µ—Ç–∏. –ú–∞—Å—Ç–µ—Ä (–ê) –∂–∏–≤, –Ω–æ –Ω–µ –≤–∏–¥–∏—Ç –°–ª–µ–π–≤–∞ –∏ –°–µ–Ω—Ç–∏–Ω–µ–ª.
3. –°–µ–Ω—Ç–∏–Ω–µ–ª –¥—É–º–∞–µ—Ç, —á—Ç–æ –ú–∞—Å—Ç–µ—Ä —É–º–µ—Ä, –∏ –ø–æ–≤—ã—à–∞–µ—Ç –°–ª–µ–π–≤–∞ (–ë) –¥–æ –Ω–æ–≤–æ–≥–æ –ú–∞—Å—Ç–µ—Ä–∞.
4. **–ü—Ä–æ–±–ª–µ–º–∞:** –°—Ç–∞—Ä—ã–π –ú–∞—Å—Ç–µ—Ä (–ê) –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç —á–∞—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∫–æ—Ç–æ—Ä—ã–µ –≤ —Ç–æ–π –∂–µ —á–∞—Å—Ç–∏ —Å–µ—Ç–∏). –ù–æ–≤—ã–π –ú–∞—Å—Ç–µ—Ä (–ë) —Ç–æ–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã.
5. **–ò—Ç–æ–≥:** –£ –Ω–∞—Å –¥–≤–∞ –ú–∞—Å—Ç–µ—Ä–∞. –î–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—è—Ç—Å—è.
6. **–§–∏–Ω–∞–ª:** –ö–æ–≥–¥–∞ —Å–µ—Ç—å —á–∏–Ω–∏—Ç—Å—è, Redis "—É–±–∏–≤–∞–µ—Ç" —Å—Ç–∞—Ä–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ (–ê) –∏ –¥–µ–ª–∞–µ—Ç –µ–≥–æ —Å–ª–µ–π–≤–æ–º. **–í—Å–µ –∑–∞–ø–∏—Å–∏, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –Ω–∞ –ê –≤–æ –≤—Ä–µ–º—è —Å–±–æ—è, —Ç–µ—Ä—è—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞.**

**–†–µ—à–µ–Ω–∏–µ (Mitigation):**
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ `min-replicas-to-write`.
–ú–∞—Å—Ç–µ—Ä (–ê) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: "–í–∏–∂—É –ª–∏ —è —Ö–æ—Ç—è –±—ã 1 —Å–ª–µ–π–≤–∞?". –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ–Ω –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø–∏—Å—å (—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è Read Only), —Å–ø–∞—Å–∞—è –Ω–∞—Å –æ—Ç –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö, –Ω–æ –∂–µ—Ä—Ç–≤—É—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é (CAP-—Ç–µ–æ—Ä–µ–º–∞ –≤ –¥–µ–π—Å—Ç–≤–∏–∏).

---